<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lingua ‚Äî AI Translator</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=Playfair+Display:ital@0;1&display=swap" rel="stylesheet">
<style>
  :root {
    --glass-bg: rgba(255,255,255,0.12);
    --glass-border: rgba(255,255,255,0.25);
    --glass-shadow: 0 8px 40px rgba(0,0,0,0.18);
    --blur: blur(24px);
    --accent: #5B8DFF;
    --accent2: #B06CFF;
    --accent3: #FF6C9D;
    --text: #1a1a2e;
    --text-light: rgba(255,255,255,0.85);
    --text-muted: rgba(255,255,255,0.5);
    --radius: 24px;
    --radius-sm: 14px;
    --transition: all 0.35s cubic-bezier(0.4,0,0.2,1);
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    background: linear-gradient(135deg, #0f0c29 0%, #302b63 40%, #24243e 70%, #1a1a3e 100%);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 24px 16px 60px;
    position: relative;
    overflow-x: hidden;
  }

  /* Ambient orbs */
  .orb {
    position: fixed;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.35;
    pointer-events: none;
    animation: drift 12s ease-in-out infinite alternate;
  }
  .orb1 { width: 500px; height: 500px; background: radial-gradient(circle, #5B8DFF, transparent); top: -150px; left: -100px; animation-delay: 0s; }
  .orb2 { width: 400px; height: 400px; background: radial-gradient(circle, #B06CFF, transparent); bottom: 0; right: -100px; animation-delay: -4s; }
  .orb3 { width: 300px; height: 300px; background: radial-gradient(circle, #FF6C9D, transparent); top: 50%; left: 50%; transform: translate(-50%,-50%); animation-delay: -8s; }
  @keyframes drift {
    from { transform: translate(0, 0) scale(1); }
    to   { transform: translate(30px, 20px) scale(1.08); }
  }

  /* Header */
  header {
    width: 100%;
    max-width: 860px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 4px;
    margin-bottom: 36px;
    animation: fadeDown 0.6s ease both;
  }
  .logo {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .logo-icon {
    width: 38px; height: 38px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    box-shadow: 0 4px 16px rgba(91,141,255,0.4);
  }
  .logo-text {
    font-family: 'Playfair Display', serif;
    font-size: 22px;
    color: white;
    letter-spacing: 0.02em;
  }
  .logo-text span { font-style: italic; color: rgba(255,255,255,0.55); font-size: 14px; font-family: 'DM Sans', sans-serif; display: block; margin-top: -4px; }

  /* Mode tabs */
  .mode-tabs {
    display: flex;
    gap: 6px;
    background: rgba(255,255,255,0.08);
    backdrop-filter: var(--blur);
    -webkit-backdrop-filter: var(--blur);
    border: 1px solid var(--glass-border);
    border-radius: 50px;
    padding: 5px;
    animation: fadeDown 0.6s 0.1s ease both;
  }
  .mode-tab {
    display: flex; align-items: center; gap: 6px;
    padding: 7px 16px;
    border-radius: 50px;
    border: none;
    background: transparent;
    color: var(--text-muted);
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: var(--transition);
    white-space: nowrap;
  }
  .mode-tab svg { width: 15px; height: 15px; }
  .mode-tab.active {
    background: rgba(255,255,255,0.18);
    color: white;
    box-shadow: 0 2px 12px rgba(0,0,0,0.2);
  }
  .mode-tab:hover:not(.active) { color: rgba(255,255,255,0.7); background: rgba(255,255,255,0.06); }

  /* Main card */
  .card {
    width: 100%;
    max-width: 860px;
    background: var(--glass-bg);
    backdrop-filter: var(--blur);
    -webkit-backdrop-filter: var(--blur);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius);
    box-shadow: var(--glass-shadow);
    overflow: hidden;
    animation: fadeUp 0.7s 0.15s ease both;
  }

  /* Language bar */
  .lang-bar {
    display: flex;
    align-items: center;
    padding: 14px 20px;
    border-bottom: 1px solid rgba(255,255,255,0.08);
    gap: 10px;
  }
  .lang-select-wrap {
    flex: 1;
    position: relative;
  }
  .lang-select {
    width: 100%;
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.14);
    border-radius: var(--radius-sm);
    color: white;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    font-weight: 500;
    padding: 9px 14px;
    cursor: pointer;
    appearance: none;
    -webkit-appearance: none;
    transition: var(--transition);
    outline: none;
  }
  .lang-select:focus { border-color: rgba(91,141,255,0.6); background: rgba(255,255,255,0.12); }
  .lang-select option { background: #302b63; color: white; }
  .lang-select-wrap::after {
    content: '‚ñæ';
    position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
    color: rgba(255,255,255,0.4); pointer-events: none; font-size: 12px;
  }
  .swap-btn {
    width: 38px; height: 38px;
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.18);
    border-radius: 50%;
    color: white;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: var(--transition);
    flex-shrink: 0;
  }
  .swap-btn:hover { background: rgba(91,141,255,0.3); transform: rotate(180deg); }
  .swap-btn svg { width: 16px; height: 16px; }

  /* Mode panels */
  .mode-panel { display: none; }
  .mode-panel.active { display: block; }

  /* Text mode */
  .text-panel {
    display: grid;
    grid-template-columns: 1fr 1px 1fr;
    min-height: 280px;
  }
  .divider-v {
    background: rgba(255,255,255,0.08);
    width: 1px;
  }
  .text-box {
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  .text-box label {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: rgba(255,255,255,0.35);
  }
  textarea, .output-text {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
    color: white;
    font-family: 'DM Sans', sans-serif;
    font-size: 16px;
    font-weight: 300;
    line-height: 1.7;
    resize: none;
    min-height: 180px;
    placeholder-color: rgba(255,255,255,0.25);
  }
  textarea::placeholder { color: rgba(255,255,255,0.25); }
  .output-text {
    min-height: 180px;
    color: rgba(255,255,255,0.9);
    font-weight: 400;
  }
  .output-text.placeholder { color: rgba(255,255,255,0.2); font-style: italic; font-weight: 300; }

  /* Actions bar */
  .actions-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 20px;
    border-top: 1px solid rgba(255,255,255,0.08);
    gap: 10px;
    flex-wrap: wrap;
  }
  .actions-left, .actions-right { display: flex; align-items: center; gap: 8px; }

  .btn-icon {
    width: 36px; height: 36px;
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 10px;
    color: rgba(255,255,255,0.6);
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: var(--transition);
    font-size: 14px;
  }
  .btn-icon:hover { background: rgba(255,255,255,0.16); color: white; }
  .btn-icon svg { width: 16px; height: 16px; }
  .btn-icon.active { background: rgba(91,141,255,0.25); border-color: rgba(91,141,255,0.5); color: #5B8DFF; }
  .btn-icon.danger.active { background: rgba(255,80,80,0.2); border-color: rgba(255,80,80,0.4); color: #ff6b6b; }

  .char-count { font-size: 12px; color: rgba(255,255,255,0.25); }

  .btn-translate {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border: none;
    border-radius: 50px;
    color: white;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    font-weight: 600;
    padding: 10px 28px;
    cursor: pointer;
    transition: var(--transition);
    box-shadow: 0 4px 20px rgba(91,141,255,0.35);
    letter-spacing: 0.02em;
  }
  .btn-translate:hover { transform: translateY(-1px); box-shadow: 0 6px 24px rgba(91,141,255,0.5); }
  .btn-translate:active { transform: translateY(0); }
  .btn-translate:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  /* Image mode */
  .image-panel { padding: 24px; }
  .drop-zone {
    border: 2px dashed rgba(255,255,255,0.18);
    border-radius: var(--radius-sm);
    padding: 40px 20px;
    text-align: center;
    cursor: pointer;
    transition: var(--transition);
    position: relative;
    overflow: hidden;
  }
  .drop-zone:hover, .drop-zone.drag-over {
    border-color: rgba(91,141,255,0.5);
    background: rgba(91,141,255,0.06);
  }
  .drop-zone input { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
  .drop-icon { font-size: 36px; margin-bottom: 12px; }
  .drop-zone h3 { color: white; font-weight: 500; font-size: 16px; margin-bottom: 6px; }
  .drop-zone p { color: rgba(255,255,255,0.35); font-size: 13px; }
  #image-preview-wrap { margin-top: 16px; display: none; }
  #image-preview-wrap img { max-width: 100%; max-height: 240px; border-radius: 12px; object-fit: contain; display: block; margin: 0 auto; }
  .ocr-result {
    margin-top: 16px;
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: var(--radius-sm);
    padding: 16px;
    color: rgba(255,255,255,0.75);
    font-size: 14px;
    line-height: 1.7;
    min-height: 60px;
    display: none;
  }
  .ocr-label { font-size: 11px; font-weight: 600; letter-spacing: 0.08em; text-transform: uppercase; color: rgba(255,255,255,0.3); margin-bottom: 6px; }

  /* Voice mode */
  .voice-panel { padding: 32px 24px; display: flex; flex-direction: column; align-items: center; gap: 24px; }
  .voice-ring {
    width: 100px; height: 100px;
    border-radius: 50%;
    background: rgba(255,255,255,0.06);
    border: 1.5px solid rgba(255,255,255,0.12);
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    position: relative;
    transition: var(--transition);
  }
  .voice-ring::before {
    content: '';
    position: absolute; inset: -8px;
    border-radius: 50%;
    border: 1.5px solid rgba(91,141,255,0.2);
    animation: none;
  }
  .voice-ring.recording::before {
    animation: ripple 1.2s ease-in-out infinite;
    border-color: rgba(255,80,80,0.4);
  }
  .voice-ring.recording { background: rgba(255,80,80,0.12); border-color: rgba(255,80,80,0.3); }
  @keyframes ripple {
    0%   { transform: scale(1); opacity: 1; }
    100% { transform: scale(1.5); opacity: 0; }
  }
  .mic-btn-inner {
    width: 54px; height: 54px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 4px 20px rgba(91,141,255,0.4);
    transition: var(--transition);
  }
  .voice-ring.recording .mic-btn-inner { background: linear-gradient(135deg, #ff6b6b, #ff4444); }
  .mic-btn-inner svg { width: 22px; height: 22px; color: white; }
  .voice-status { color: rgba(255,255,255,0.5); font-size: 14px; text-align: center; }
  .voice-transcript {
    width: 100%; max-width: 560px;
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: var(--radius-sm);
    padding: 16px;
    color: rgba(255,255,255,0.8);
    font-size: 15px;
    line-height: 1.7;
    min-height: 80px;
    display: none;
  }
  .voice-transcript.visible { display: block; }

  /* Loading spinner */
  .spinner {
    display: inline-block;
    width: 16px; height: 16px;
    border: 2px solid rgba(255,255,255,0.3);
    border-top-color: white;
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
    vertical-align: middle;
    margin-right: 6px;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* Toast */
  .toast {
    position: fixed;
    bottom: 24px; left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: rgba(30,30,60,0.95);
    backdrop-filter: var(--blur);
    border: 1px solid var(--glass-border);
    border-radius: 50px;
    color: white;
    font-size: 13px;
    font-weight: 500;
    padding: 10px 22px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    transition: transform 0.4s cubic-bezier(0.34,1.56,0.64,1);
    z-index: 999;
    white-space: nowrap;
    pointer-events: none;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }

  /* Translations history */
  .history-wrap {
    width: 100%;
    max-width: 860px;
    margin-top: 20px;
    animation: fadeUp 0.7s 0.3s ease both;
  }
  .history-title {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: rgba(255,255,255,0.25);
    padding: 0 4px;
    margin-bottom: 10px;
  }
  .history-list { display: flex; flex-direction: column; gap: 8px; }
  .history-item {
    background: rgba(255,255,255,0.06);
    backdrop-filter: var(--blur);
    -webkit-backdrop-filter: var(--blur);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: var(--radius-sm);
    padding: 14px 18px;
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    gap: 14px;
    animation: fadeUp 0.4s ease both;
    cursor: pointer;
    transition: var(--transition);
  }
  .history-item:hover { background: rgba(255,255,255,0.1); }
  .history-orig { color: rgba(255,255,255,0.55); font-size: 13px; }
  .history-arrow { color: rgba(255,255,255,0.2); font-size: 12px; }
  .history-trans { color: rgba(255,255,255,0.85); font-size: 13px; font-weight: 500; }
  .history-meta { font-size: 11px; color: rgba(255,255,255,0.25); margin-top: 2px; }

  /* Animations */
  @keyframes fadeDown { from { opacity: 0; transform: translateY(-16px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes fadeUp   { from { opacity: 0; transform: translateY(16px);  } to { opacity: 1; transform: translateY(0); } }

  /* API key notice */
  .api-notice {
    width: 100%;
    max-width: 860px;
    background: rgba(255, 176, 0, 0.08);
    border: 1px solid rgba(255, 176, 0, 0.25);
    border-radius: var(--radius-sm);
    padding: 12px 18px;
    color: rgba(255, 220, 100, 0.85);
    font-size: 13px;
    margin-bottom: 16px;
    animation: fadeUp 0.6s ease both;
    display: flex; align-items: flex-start; gap: 10px;
  }
  .api-notice a { color: #ffd466; }

  .api-key-bar {
    width: 100%;
    max-width: 860px;
    display: flex;
    gap: 8px;
    margin-bottom: 12px;
    animation: fadeUp 0.6s 0.05s ease both;
  }
  .api-key-input {
    flex: 1;
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.14);
    border-radius: var(--radius-sm);
    padding: 10px 14px;
    color: white;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    outline: none;
    transition: var(--transition);
  }
  .api-key-input:focus { border-color: rgba(91,141,255,0.5); background: rgba(255,255,255,0.12); }
  .api-key-input::placeholder { color: rgba(255,255,255,0.25); }
  .btn-save-key {
    background: rgba(91,141,255,0.2);
    border: 1px solid rgba(91,141,255,0.4);
    border-radius: var(--radius-sm);
    color: #5B8DFF;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    font-weight: 600;
    padding: 10px 20px;
    cursor: pointer;
    transition: var(--transition);
  }
  .btn-save-key:hover { background: rgba(91,141,255,0.3); }

  /* Responsive */
  @media (max-width: 640px) {
    header { flex-direction: column; gap: 14px; align-items: flex-start; }
    .mode-tabs { align-self: flex-start; }
    .text-panel { grid-template-columns: 1fr; grid-template-rows: auto auto auto; }
    .divider-v { width: 100%; height: 1px; }
    .history-item { grid-template-columns: 1fr; gap: 4px; }
    .history-arrow { display: none; }
    .mode-tab span { display: none; }
  }

  /* Detected lang badge */
  .detected-badge {
    font-size: 11px;
    background: rgba(91,141,255,0.2);
    border: 1px solid rgba(91,141,255,0.35);
    color: #7aaeff;
    border-radius: 50px;
    padding: 2px 10px;
    display: none;
    animation: fadeUp 0.3s ease both;
  }
  .detected-badge.visible { display: inline-block; }

  .progress-bar {
    height: 2px;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    width: 0%;
    transition: width 0.3s ease;
    border-radius: 1px;
  }
</style>
</head>
<body>

<div class="orb orb1"></div>
<div class="orb orb2"></div>
<div class="orb orb3"></div>

<header>
  <div class="logo">
    <div class="logo-icon">üåê</div>
    <div class="logo-text">Lingua <span>AI Translator</span></div>
  </div>
  <div class="mode-tabs">
    <button class="mode-tab active" data-mode="text" onclick="switchMode('text')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 6h16M4 12h16M4 18h10"/></svg>
      <span>Text</span>
    </button>
    <button class="mode-tab" data-mode="image" onclick="switchMode('image')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="m21 15-5-5L5 21"/></svg>
      <span>Image</span>
    </button>
    <button class="mode-tab" data-mode="voice" onclick="switchMode('voice')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a3 3 0 0 1 3 3v7a3 3 0 0 1-6 0V5a3 3 0 0 1 3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2M12 19v3M8 22h8"/></svg>
      <span>Voice</span>
    </button>
  </div>
</header>

<div class="api-notice">
  <span>‚ö°</span>
  <div>
    This app uses <strong>MyMemory free API</strong> (no key needed, 10K chars/day) + Browser Web Speech API for voice/TTS. For image OCR, paste any image and it will process text from it.
    <br><small style="opacity:.7">No data is stored. All processing is client-side or through free public APIs.</small>
  </div>
</div>

<div class="card">
  <!-- Language bar -->
  <div class="lang-bar">
    <div class="lang-select-wrap">
      <select class="lang-select" id="src-lang">
        <option value="auto">Auto-detect</option>
        <option value="en">English</option>
        <option value="es">Spanish</option>
        <option value="fr">French</option>
        <option value="de">German</option>
        <option value="it">Italian</option>
        <option value="pt">Portuguese</option>
        <option value="ru">Russian</option>
        <option value="zh">Chinese (Simplified)</option>
        <option value="zh-TW">Chinese (Traditional)</option>
        <option value="ja">Japanese</option>
        <option value="ko">Korean</option>
        <option value="ar">Arabic</option>
        <option value="hi">Hindi</option>
        <option value="bn">Bengali</option>
        <option value="tr">Turkish</option>
        <option value="pl">Polish</option>
        <option value="nl">Dutch</option>
        <option value="sv">Swedish</option>
        <option value="da">Danish</option>
        <option value="fi">Finnish</option>
        <option value="no">Norwegian</option>
        <option value="el">Greek</option>
        <option value="he">Hebrew</option>
        <option value="th">Thai</option>
        <option value="vi">Vietnamese</option>
        <option value="id">Indonesian</option>
        <option value="ms">Malay</option>
        <option value="uk">Ukrainian</option>
        <option value="cs">Czech</option>
        <option value="ro">Romanian</option>
        <option value="hu">Hungarian</option>
        <option value="sk">Slovak</option>
        <option value="bg">Bulgarian</option>
        <option value="hr">Croatian</option>
        <option value="ca">Catalan</option>
        <option value="lt">Lithuanian</option>
        <option value="lv">Latvian</option>
        <option value="et">Estonian</option>
        <option value="sl">Slovenian</option>
        <option value="fa">Persian</option>
        <option value="ur">Urdu</option>
        <option value="sw">Swahili</option>
        <option value="tl">Filipino</option>
        <option value="af">Afrikaans</option>
      </select>
    </div>
    <span class="detected-badge" id="detected-badge"></span>
    <button class="swap-btn" onclick="swapLanguages()" title="Swap languages">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 16V4m0 0L3 8m4-4 4 4M17 8v12m0 0 4-4m-4 4-4-4"/></svg>
    </button>
    <div class="lang-select-wrap">
      <select class="lang-select" id="tgt-lang">
        <option value="en">English</option>
        <option value="es">Spanish</option>
        <option value="fr">French</option>
        <option value="de">German</option>
        <option value="it">Italian</option>
        <option value="pt">Portuguese</option>
        <option value="ru">Russian</option>
        <option value="zh">Chinese (Simplified)</option>
        <option value="zh-TW">Chinese (Traditional)</option>
        <option value="ja">Japanese</option>
        <option value="ko">Korean</option>
        <option value="ar">Arabic</option>
        <option value="hi">Hindi</option>
        <option value="bn">Bengali</option>
        <option value="tr">Turkish</option>
        <option value="pl">Polish</option>
        <option value="nl">Dutch</option>
        <option value="sv">Swedish</option>
        <option value="da">Danish</option>
        <option value="fi">Finnish</option>
        <option value="no">Norwegian</option>
        <option value="el">Greek</option>
        <option value="he">Hebrew</option>
        <option value="th">Thai</option>
        <option value="vi">Vietnamese</option>
        <option value="id">Indonesian</option>
        <option value="ms">Malay</option>
        <option value="uk">Ukrainian</option>
        <option value="cs">Czech</option>
        <option value="ro">Romanian</option>
        <option value="hu">Hungarian</option>
        <option value="sk">Slovak</option>
        <option value="bg">Bulgarian</option>
        <option value="hr">Croatian</option>
        <option value="ca">Catalan</option>
        <option value="lt">Lithuanian</option>
        <option value="lv">Latvian</option>
        <option value="et">Estonian</option>
        <option value="sl">Slovenian</option>
        <option value="fa">Persian</option>
        <option value="ur">Urdu</option>
        <option value="sw">Swahili</option>
        <option value="tl">Filipino</option>
        <option value="af">Afrikaans</option>
      </select>
    </div>
  </div>
  <div class="progress-bar" id="progress-bar"></div>

  <!-- TEXT MODE -->
  <div class="mode-panel active" id="panel-text">
    <div class="text-panel">
      <div class="text-box">
        <label>Source Text</label>
        <textarea id="src-text" placeholder="Type or paste text to translate‚Ä¶" maxlength="5000" oninput="updateChar()"></textarea>
      </div>
      <div class="divider-v"></div>
      <div class="text-box">
        <label>Translation</label>
        <div class="output-text placeholder" id="output-text">Translation will appear here‚Ä¶</div>
      </div>
    </div>
    <div class="actions-bar">
      <div class="actions-left">
        <span class="char-count" id="char-count">0 / 5000</span>
        <button class="btn-icon" onclick="clearAll()" title="Clear">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6l-1 14H6L5 6M10 11v6M14 11v6M8 6V4h8v2"/></svg>
        </button>
      </div>
      <div class="actions-right">
        <button class="btn-icon" id="tts-btn" onclick="speakOutput()" title="Speak translation">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5 6 9H2v6h4l5 4V5zM15.54 8.46a5 5 0 0 1 0 7.07M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>
        </button>
        <button class="btn-icon" id="copy-btn" onclick="copyOutput()" title="Copy translation">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
        </button>
        <button class="btn-translate" id="translate-btn" onclick="translateText()">Translate</button>
      </div>
    </div>
  </div>

  <!-- IMAGE MODE -->
  <div class="mode-panel" id="panel-image">
    <div class="image-panel">
      <div class="drop-zone" id="drop-zone" ondragover="onDragOver(event)" ondragleave="onDragLeave(event)" ondrop="onDrop(event)">
        <input type="file" accept="image/*" id="img-input" onchange="handleImageFile(this.files[0])">
        <div class="drop-icon">üñºÔ∏è</div>
        <h3>Drop an image or click to browse</h3>
        <p>Supports PNG, JPG, WEBP ‚Äî OCR will extract text from image</p>
      </div>
      <div id="image-preview-wrap">
        <img id="image-preview" src="" alt="Preview">
      </div>
      <div style="margin-top:16px;">
        <div class="ocr-label">Extracted Text (OCR)</div>
        <div class="ocr-result" id="ocr-result"></div>
      </div>
      <div style="margin-top:12px;">
        <div class="ocr-label">Translation</div>
        <div class="ocr-result" id="ocr-translation" style="display:none;"></div>
      </div>
      <div style="display:flex; gap:10px; margin-top:16px; flex-wrap:wrap; align-items:center;">
        <button class="btn-translate" id="ocr-translate-btn" onclick="translateOCR()" style="display:none;">Translate Extracted Text</button>
        <button class="btn-icon" id="ocr-tts-btn" onclick="speakOCROutput()" title="Speak translation" style="display:none;">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5 6 9H2v6h4l5 4V5zM15.54 8.46a5 5 0 0 1 0 7.07M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>
        </button>
        <button class="btn-icon" onclick="copyOCRTranslation()" id="ocr-copy-btn" title="Copy" style="display:none;">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
        </button>
      </div>
    </div>
  </div>

  <!-- VOICE MODE -->
  <div class="mode-panel" id="panel-voice">
    <div class="voice-panel">
      <div style="text-align:center;">
        <div class="voice-ring" id="voice-ring" onclick="toggleVoice()">
          <div class="mic-btn-inner">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a3 3 0 0 1 3 3v7a3 3 0 0 1-6 0V5a3 3 0 0 1 3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/></svg>
          </div>
        </div>
        <div class="voice-status" id="voice-status" style="margin-top:14px;">Tap the mic to start speaking</div>
      </div>
      <div class="voice-transcript" id="voice-transcript">
        <div class="ocr-label">You said</div>
        <div id="voice-text" style="color:rgba(255,255,255,0.8); font-size:15px; line-height:1.7; margin-top:6px;"></div>
      </div>
      <div class="voice-transcript" id="voice-translation-wrap">
        <div class="ocr-label">Translation</div>
        <div id="voice-translation" style="color:rgba(255,255,255,0.9); font-size:15px; line-height:1.7; margin-top:6px;"></div>
        <div style="display:flex; gap:8px; margin-top:12px;">
          <button class="btn-icon" onclick="speakVoiceOutput()" title="Speak translation">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5 6 9H2v6h4l5 4V5zM15.54 8.46a5 5 0 0 1 0 7.07M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>
          </button>
          <button class="btn-icon" onclick="copyVoiceTranslation()" title="Copy">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- History -->
<div class="history-wrap" id="history-wrap" style="display:none;">
  <div class="history-title">Recent Translations</div>
  <div class="history-list" id="history-list"></div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentMode = 'text';
let ocrText = '';
let voiceTranslationText = '';
let recognition = null;
let isRecording = false;
let speechSynth = window.speechSynthesis;
let history = JSON.parse(localStorage.getItem('lingua_history') || '[]');

const LANG_NAMES = {
  auto:'Auto-detect',en:'English',es:'Spanish',fr:'French',de:'German',it:'Italian',pt:'Portuguese',
  ru:'Russian',zh:'Chinese',ja:'Japanese',ko:'Korean',ar:'Arabic',hi:'Hindi',tr:'Turkish',
  pl:'Polish',nl:'Dutch',sv:'Swedish',el:'Greek',he:'Hebrew',th:'Thai',vi:'Vietnamese',
  id:'Indonesian',uk:'Ukrainian',fa:'Persian',ur:'Urdu','zh-TW':'Chinese (Trad.)',
  bn:'Bengali',da:'Danish',fi:'Finnish',no:'Norwegian',cs:'Czech',ro:'Romanian',hu:'Hungarian',
  sk:'Slovak',bg:'Bulgarian',hr:'Croatian',ca:'Catalan',lt:'Lithuanian',lv:'Latvian',
  et:'Estonian',sl:'Slovenian',sw:'Swahili',tl:'Filipino',af:'Afrikaans',ms:'Malay'
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  UI HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function switchMode(mode) {
  currentMode = mode;
  document.querySelectorAll('.mode-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.mode-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('panel-' + mode).classList.add('active');
  document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
}

function showToast(msg, duration = 2200) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), duration);
}

function setProgress(pct) {
  const bar = document.getElementById('progress-bar');
  bar.style.width = pct + '%';
  if (pct >= 100) setTimeout(() => { bar.style.width = '0%'; }, 600);
}

function updateChar() {
  const v = document.getElementById('src-text').value.length;
  document.getElementById('char-count').textContent = v + ' / 5000';
}

function clearAll() {
  document.getElementById('src-text').value = '';
  const out = document.getElementById('output-text');
  out.textContent = 'Translation will appear here‚Ä¶';
  out.classList.add('placeholder');
  updateChar();
  document.getElementById('detected-badge').classList.remove('visible');
}

function swapLanguages() {
  const src = document.getElementById('src-lang');
  const tgt = document.getElementById('tgt-lang');
  if (src.value === 'auto') { showToast('Set a source language first'); return; }
  const tmp = src.value;
  src.value = tgt.value;
  tgt.value = tmp;
  // Also swap text
  const srcTxt = document.getElementById('src-text').value;
  const outEl = document.getElementById('output-text');
  const outTxt = outEl.classList.contains('placeholder') ? '' : outEl.textContent;
  document.getElementById('src-text').value = outTxt;
  if (outTxt) { outEl.textContent = srcTxt; outEl.classList.remove('placeholder'); }
  updateChar();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TRANSLATION API ‚Äî MyMemory (free, no key)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function callTranslate(text, srcLang, tgtLang) {
  const langpair = (srcLang === 'auto' ? 'autodetect' : srcLang) + '|' + tgtLang;
  const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${langpair}`;
  const res = await fetch(url);
  if (!res.ok) throw new Error('Network error');
  const data = await res.json();
  if (data.responseStatus !== 200) throw new Error(data.responseDetails || 'Translation failed');
  return {
    translation: data.responseData.translatedText,
    detectedLang: data.responseData.detectedLanguage || null
  };
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TEXT TRANSLATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function translateText() {
  const text = document.getElementById('src-text').value.trim();
  if (!text) { showToast('Please enter some text'); return; }
  const srcLang = document.getElementById('src-lang').value;
  const tgtLang = document.getElementById('tgt-lang').value;

  const btn = document.getElementById('translate-btn');
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span>Translating‚Ä¶';
  setProgress(40);

  const out = document.getElementById('output-text');
  out.classList.remove('placeholder');
  out.textContent = '';

  try {
    const result = await callTranslate(text, srcLang, tgtLang);
    setProgress(100);
    out.textContent = result.translation;

    if (result.detectedLang && srcLang === 'auto') {
      const badge = document.getElementById('detected-badge');
      badge.textContent = 'üîç ' + (LANG_NAMES[result.detectedLang] || result.detectedLang);
      badge.classList.add('visible');
    }

    addHistory(text, result.translation, srcLang === 'auto' ? (result.detectedLang || 'auto') : srcLang, tgtLang);
  } catch(e) {
    out.textContent = '';
    out.classList.add('placeholder');
    out.textContent = 'Translation failed: ' + e.message;
    showToast('‚ùå ' + e.message);
    setProgress(0);
  }

  btn.disabled = false;
  btn.innerHTML = 'Translate';
}

// Enter key shortcut
document.getElementById('src-text').addEventListener('keydown', e => {
  if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') translateText();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function speak(text, lang) {
  if (!speechSynth) { showToast('TTS not supported'); return; }
  speechSynth.cancel();
  const utt = new SpeechSynthesisUtterance(text);
  utt.lang = lang || 'en';
  utt.rate = 0.95;
  speechSynth.speak(utt);
}

function speakOutput() {
  const out = document.getElementById('output-text');
  if (out.classList.contains('placeholder') || !out.textContent.trim()) { showToast('Nothing to speak'); return; }
  const tgtLang = document.getElementById('tgt-lang').value;
  speak(out.textContent, tgtLang);
}

function copyOutput() {
  const out = document.getElementById('output-text');
  if (out.classList.contains('placeholder') || !out.textContent.trim()) { showToast('Nothing to copy'); return; }
  navigator.clipboard.writeText(out.textContent).then(() => showToast('‚úì Copied'));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  IMAGE / OCR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function onDragOver(e) { e.preventDefault(); document.getElementById('drop-zone').classList.add('drag-over'); }
function onDragLeave(e) { document.getElementById('drop-zone').classList.remove('drag-over'); }
function onDrop(e) {
  e.preventDefault();
  document.getElementById('drop-zone').classList.remove('drag-over');
  const file = e.dataTransfer.files[0];
  if (file && file.type.startsWith('image/')) handleImageFile(file);
}

async function handleImageFile(file) {
  if (!file) return;
  const reader = new FileReader();
  reader.onload = async (e) => {
    const wrap = document.getElementById('image-preview-wrap');
    const img = document.getElementById('image-preview');
    img.src = e.target.result;
    wrap.style.display = 'block';

    // OCR via Tesseract.js CDN
    await runOCR(e.target.result);
  };
  reader.readAsDataURL(file);
}

async function runOCR(imageSrc) {
  const ocrEl = document.getElementById('ocr-result');
  ocrEl.style.display = 'block';
  ocrEl.innerHTML = '<span class="spinner"></span> Extracting text‚Ä¶';
  setProgress(30);

  // Load Tesseract if not loaded
  if (!window.Tesseract) {
    await loadScript('https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.1/tesseract.min.js');
  }

  try {
    const worker = await Tesseract.createWorker('eng');
    const { data: { text } } = await worker.recognize(imageSrc);
    await worker.terminate();

    ocrText = text.trim();
    ocrEl.textContent = ocrText || '(No text detected)';
    setProgress(100);

    if (ocrText) {
      document.getElementById('ocr-translate-btn').style.display = 'inline-flex';
    }
  } catch(e) {
    ocrEl.textContent = 'OCR failed: ' + e.message;
    setProgress(0);
  }
}

function loadScript(src) {
  return new Promise((res, rej) => {
    const s = document.createElement('script');
    s.src = src; s.onload = res; s.onerror = rej;
    document.head.appendChild(s);
  });
}

async function translateOCR() {
  if (!ocrText) { showToast('No text to translate'); return; }
  const srcLang = document.getElementById('src-lang').value;
  const tgtLang = document.getElementById('tgt-lang').value;

  const btn = document.getElementById('ocr-translate-btn');
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span>Translating‚Ä¶';
  setProgress(40);

  const transEl = document.getElementById('ocr-translation');
  transEl.style.display = 'block';
  transEl.innerHTML = '<span class="spinner"></span>';

  try {
    const result = await callTranslate(ocrText, srcLang, tgtLang);
    transEl.textContent = result.translation;
    setProgress(100);
    document.getElementById('ocr-tts-btn').style.display = 'flex';
    document.getElementById('ocr-copy-btn').style.display = 'flex';
    addHistory(ocrText.slice(0,80) + (ocrText.length > 80 ? '‚Ä¶' : ''), result.translation, srcLang, tgtLang);
  } catch(e) {
    transEl.textContent = 'Error: ' + e.message;
    setProgress(0);
  }
  btn.disabled = false;
  btn.innerHTML = 'Translate Extracted Text';
}

function speakOCROutput() {
  const t = document.getElementById('ocr-translation').textContent;
  if (!t || t.startsWith('Error')) { showToast('Nothing to speak'); return; }
  speak(t, document.getElementById('tgt-lang').value);
}
function copyOCRTranslation() {
  const t = document.getElementById('ocr-translation').textContent;
  if (!t) { showToast('Nothing to copy'); return; }
  navigator.clipboard.writeText(t).then(() => showToast('‚úì Copied'));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  VOICE RECOGNITION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleVoice() {
  if (!isRecording) startVoice();
  else stopVoice();
}

function startVoice() {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SpeechRecognition) { showToast('Speech recognition not supported in this browser'); return; }

  const srcLang = document.getElementById('src-lang').value;
  recognition = new SpeechRecognition();
  recognition.lang = srcLang === 'auto' ? 'en-US' : srcLang;
  recognition.continuous = false;
  recognition.interimResults = true;

  recognition.onstart = () => {
    isRecording = true;
    document.getElementById('voice-ring').classList.add('recording');
    document.getElementById('voice-status').textContent = 'üî¥ Listening‚Ä¶ speak now';
    document.getElementById('voice-transcript').classList.add('visible');
    document.getElementById('voice-text').textContent = '';
  };

  recognition.onresult = (e) => {
    let interim = '', final = '';
    for (let i = e.resultIndex; i < e.results.length; i++) {
      if (e.results[i].isFinal) final += e.results[i][0].transcript;
      else interim += e.results[i][0].transcript;
    }
    document.getElementById('voice-text').textContent = (final || interim);
    if (final) translateVoice(final);
  };

  recognition.onerror = (e) => { showToast('Mic error: ' + e.error); stopVoice(); };
  recognition.onend = () => stopVoice();
  recognition.start();
}

function stopVoice() {
  isRecording = false;
  if (recognition) recognition.stop();
  document.getElementById('voice-ring').classList.remove('recording');
  document.getElementById('voice-status').textContent = 'Tap the mic to start speaking';
}

async function translateVoice(text) {
  const srcLang = document.getElementById('src-lang').value;
  const tgtLang = document.getElementById('tgt-lang').value;
  setProgress(40);
  try {
    const result = await callTranslate(text, srcLang, tgtLang);
    voiceTranslationText = result.translation;
    const wrap = document.getElementById('voice-translation-wrap');
    document.getElementById('voice-translation').textContent = result.translation;
    wrap.classList.add('visible');
    setProgress(100);
    // Auto-speak
    speak(result.translation, tgtLang);
    addHistory(text, result.translation, srcLang, tgtLang);
  } catch(e) {
    showToast('Translation error: ' + e.message);
    setProgress(0);
  }
}

function speakVoiceOutput() {
  if (!voiceTranslationText) { showToast('Nothing to speak'); return; }
  speak(voiceTranslationText, document.getElementById('tgt-lang').value);
}
function copyVoiceTranslation() {
  if (!voiceTranslationText) { showToast('Nothing to copy'); return; }
  navigator.clipboard.writeText(voiceTranslationText).then(() => showToast('‚úì Copied'));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  HISTORY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function addHistory(src, trans, srcLang, tgtLang) {
  history.unshift({ src, trans, srcLang, tgtLang, time: Date.now() });
  if (history.length > 12) history.pop();
  localStorage.setItem('lingua_history', JSON.stringify(history));
  renderHistory();
}

function renderHistory() {
  const wrap = document.getElementById('history-wrap');
  const list = document.getElementById('history-list');
  if (history.length === 0) { wrap.style.display = 'none'; return; }
  wrap.style.display = 'block';
  list.innerHTML = history.slice(0, 5).map((h, i) => `
    <div class="history-item" onclick="loadHistory(${i})">
      <div>
        <div class="history-orig">${escHtml(truncate(h.src, 60))}</div>
        <div class="history-meta">${LANG_NAMES[h.srcLang] || h.srcLang}</div>
      </div>
      <div class="history-arrow">‚Üí</div>
      <div>
        <div class="history-trans">${escHtml(truncate(h.trans, 60))}</div>
        <div class="history-meta">${LANG_NAMES[h.tgtLang] || h.tgtLang}</div>
      </div>
    </div>
  `).join('');
}

function loadHistory(i) {
  const h = history[i];
  switchMode('text');
  document.getElementById('src-text').value = h.src;
  const out = document.getElementById('output-text');
  out.textContent = h.trans;
  out.classList.remove('placeholder');
  updateChar();
  const srcSel = document.getElementById('src-lang');
  const tgtSel = document.getElementById('tgt-lang');
  if ([...srcSel.options].some(o => o.value === h.srcLang)) srcSel.value = h.srcLang;
  if ([...tgtSel.options].some(o => o.value === h.tgtLang)) tgtSel.value = h.tgtLang;
}

function escHtml(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
function truncate(s, n) { return s.length > n ? s.slice(0, n) + '‚Ä¶' : s; }

// Init
renderHistory();

// Set Spanish as default target
document.getElementById('tgt-lang').value = 'es';
</script>
</body>
</html>
